{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["const API_KEY = '50736279-c1f88b0db9e0d00ad72cdf14a';\nconst BASE_URL = 'https://pixabay.com/api/';\nimport axios from 'axios';\n\nexport async function getImagesByQuery(query, page = 1) {\n  const params = {\n    key: API_KEY,\n    q: encodeURIComponent(query),\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    page: page,\n    per_page: 40,\n  };\n\n  try {\n    console.log(`Searching Pixabay for: \"${query}\", page: ${page}`);\n    const response = await axios.get(BASE_URL, { params });\n\n    return response.data;\n  } catch (error) {\n    console.error('Error fetching images from Pixabay:', error.message);\n\n    if (error.response?.status === 429) {\n      throw new Error('Rate limit exceeded');\n    } else if (error.response?.status === 400) {\n      throw new Error('Invalid API request');\n    } else {\n      throw new Error('Network error');\n    }\n  }\n}\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nexport function createGallery(images) {\n  const gallery = document.querySelector('.gallery');\n\n  if (!images || !images.hits || images.hits.length === 0) {\n    gallery.innerHTML =\n      '<p class=\"no-results\">No images found. Try another search.</p>';\n    return;\n  }\n\n  const markup = images.hits\n    .map(image => {\n      return `\n        <li class=\"gallery-item\">\n          <a class=\"gallery-link\" href=\"${image.largeImageURL}\">\n            <div class=\"gallery-card\">\n              <img \n                class=\"gallery-image\" \n                src=\"${image.webformatURL}\" \n                alt=\"${image.tags}\" \n                loading=\"lazy\" \n              />\n              <div class=\"image-info\">\n                <div class=\"info-item\">\n                  <span class=\"info-label\">Likes</span>\n                  <span class=\"info-value\">${image.likes}</span>\n                </div>\n                <div class=\"info-item\">\n                  <span class=\"info-label\">Views</span>\n                  <span class=\"info-value\">${image.views}</span>\n                </div>\n                <div class=\"info-item\">\n                  <span class=\"info-label\">Comments</span>\n                  <span class=\"info-value\">${image.comments}</span>\n                </div>\n                <div class=\"info-item\">\n                  <span class=\"info-label\">Downloads</span>\n                  <span class=\"info-value\">${image.downloads}</span>\n                </div>\n              </div>\n            </div>\n          </a>\n        </li>\n      `;\n    })\n    .join('');\n\n  gallery.innerHTML = markup;\n\n  // Инициализируем SimpleLightbox\n  if (!window.lightbox) {\n    window.lightbox = new SimpleLightbox('.gallery a', {\n      captionsData: 'alt',\n      captionDelay: 250,\n    });\n  } else {\n    window.lightbox.refresh();\n  }\n}\n\nexport function clearGallery() {\n  const gallery = document.querySelector('.gallery');\n  if (gallery) {\n    gallery.innerHTML = '';\n  }\n  if (window.lightbox) {\n    window.lightbox.destroy();\n    window.lightbox = null;\n  }\n}\n\nexport function showLoader() {\n  const loader = document.querySelector('.loader-container');\n  if (loader) {\n    loader.style.display = 'flex';\n  }\n}\n\nexport function hideLoader() {\n  const loader = document.querySelector('.loader-container');\n  if (loader) {\n    loader.style.display = 'none';\n  }\n}\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport './css/styles.css';\nimport { getImagesByQuery } from './js/pixabay-api.js';\nimport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n} from './js/render-functions.js';\n\nconsole.log('App loaded successfully!');\n\n// Элементы DOM\nconst form = document.querySelector('.form');\nconst mainElement = document.querySelector('main');\nconst gallery = document.querySelector('.gallery');\nconst loader = document.querySelector('.loader-container');\n\n// Переменные состояния\nlet currentPage = 1;\nlet currentQuery = '';\nlet isLoading = false;\nlet totalHits = 0;\n\n// Изначально скрываем main\nmainElement.style.display = 'none';\n\n// Обработчик формы\nform.addEventListener('submit', async e => {\n  e.preventDefault();\n\n  if (isLoading) {\n    console.log('Already loading, please wait...');\n    return;\n  }\n\n  const searchQuery = form.elements['search-text'].value.trim();\n\n  if (!searchQuery) {\n    showWarningToast('Please enter a search term');\n    return;\n  }\n\n  // Сброс состояния\n  currentQuery = searchQuery;\n  currentPage = 1;\n  isLoading = true;\n\n  // Показываем лоадер\n  showLoader();\n\n  // Очищаем галерею\n  clearGallery();\n\n  try {\n    console.log(`Starting search for: \"${searchQuery}\"`);\n\n    // Делаем запрос к API\n    const data = await getImagesByQuery(searchQuery, currentPage);\n    console.log('Data received, total hits:', data.totalHits);\n\n    // Скрываем лоадер\n    hideLoader();\n    isLoading = false;\n\n    // Показываем main\n    mainElement.style.display = 'block';\n    mainElement.classList.add('has-results');\n\n    // Проверяем результаты\n    if (!data || !data.hits || data.hits.length === 0) {\n      console.log('No images found for query:', searchQuery);\n      showErrorToast(\n        'Sorry, there are no images matching your search query. Please try again!'\n      );\n\n      // Показываем сообщение в галерее\n      gallery.innerHTML =\n        '<p class=\"no-results\">No images found. Try another search term.</p>';\n      return;\n    }\n\n    // Сохраняем общее количество найденных изображений\n    totalHits = data.totalHits || data.hits.length;\n    console.log(\n      `Found ${totalHits} total hits, showing ${data.hits.length} images`\n    );\n\n    // Показываем галерею\n    createGallery(data);\n\n    // Прокручиваем к результатам\n    setTimeout(() => {\n      mainElement.scrollIntoView({\n        behavior: 'smooth',\n        block: 'start',\n      });\n    }, 100);\n  } catch (error) {\n    console.error('Search error:', error);\n    hideLoader();\n    isLoading = false;\n\n    // Проверяем тип ошибки для правильного сообщения\n    if (error.message.includes('Rate limit')) {\n      showErrorToast(\n        'Rate limit exceeded. Please wait a minute before searching again.'\n      );\n    } else if (error.message.includes('Network')) {\n      showErrorToast('Network error. Please check your internet connection.');\n    } else {\n      showErrorToast(\n        'An error occurred while fetching images. Please try again later.'\n      );\n    }\n\n    // Показываем сообщение об ошибке\n    gallery.innerHTML = `<p class=\"no-results\">Error loading images. Please try again.</p>`;\n  }\n});\n\n// Обработчик бесконечной прокрутки\nwindow.addEventListener('scroll', () => {\n  if (isLoading || !currentQuery) return;\n\n  const { scrollTop, scrollHeight, clientHeight } = document.documentElement;\n\n  // Если пользователь прокрутил до конца страницы\n  if (scrollTop + clientHeight >= scrollHeight - 500) {\n    loadMoreImages();\n  }\n});\n\n// Функция для загрузки дополнительных изображений\nasync function loadMoreImages() {\n  if (isLoading) return;\n\n  // Проверяем, есть ли еще изображения для загрузки\n  const loadedImages = currentPage * 40;\n  if (loadedImages >= totalHits) {\n    console.log('All images loaded');\n    return;\n  }\n\n  isLoading = true;\n  showLoader();\n\n  try {\n    currentPage++;\n    console.log(`Loading more images, page ${currentPage}`);\n\n    const data = await getImagesByQuery(currentQuery, currentPage);\n\n    if (data.hits && data.hits.length > 0) {\n      // Добавляем новые изображения\n      const newMarkup = data.hits\n        .map(\n          image => `\n        <li class=\"gallery-item\">\n          <a class=\"gallery-link\" href=\"${image.largeImageURL}\">\n            <div class=\"gallery-card\">\n              <img \n                class=\"gallery-image\" \n                src=\"${image.webformatURL}\" \n                alt=\"${image.tags}\" \n                loading=\"lazy\" \n              />\n              <div class=\"image-info\">\n                <div class=\"info-item\">\n                  <span class=\"info-label\">Likes</span>\n                  <span class=\"info-value\">${image.likes}</span>\n                </div>\n                <div class=\"info-item\">\n                  <span class=\"info-label\">Views</span>\n                  <span class=\"info-value\">${image.views}</span>\n                </div>\n                <div class=\"info-item\">\n                  <span class=\"info-label\">Comments</span>\n                  <span class=\"info-value\">${image.comments}</span>\n                </div>\n                <div class=\"info-item\">\n                  <span class=\"info-label\">Downloads</span>\n                  <span class=\"info-value\">${image.downloads}</span>\n                </div>\n              </div>\n            </div>\n          </a>\n        </li>\n      `\n        )\n        .join('');\n\n      gallery.insertAdjacentHTML('beforeend', newMarkup);\n\n      // Обновляем лайтбокс\n      if (window.lightbox) {\n        window.lightbox.refresh();\n      }\n\n      // Плавная прокрутка к новым изображениям\n      const galleryItems = document.querySelectorAll('.gallery-item');\n      if (galleryItems.length > 0) {\n        const lastItem = galleryItems[galleryItems.length - 1];\n        lastItem.scrollIntoView({\n          behavior: 'smooth',\n          block: 'end',\n        });\n      }\n    }\n  } catch (error) {\n    console.error('Load more error:', error);\n    showErrorToast('Failed to load more images.');\n    currentPage--;\n  } finally {\n    hideLoader();\n    isLoading = false;\n  }\n}\n\n// Функции для уведомлений\nfunction showErrorToast(message) {\n  iziToast.error({\n    title: '',\n    message: message,\n    position: 'topRight',\n    timeout: 5000,\n    backgroundColor: '#EF4040',\n    theme: 'dark',\n    progressBarColor: '#D32F2F',\n    iconColor: '#FFFFFF',\n    titleColor: '#FFFFFF',\n    messageColor: '#FFFFFF',\n    close: true,\n    closeOnEscape: true,\n    closeOnClick: true,\n    displayMode: 'replace',\n  });\n}\n\nfunction showWarningToast(message) {\n  iziToast.warning({\n    title: '',\n    message: message,\n    position: 'topRight',\n    timeout: 3000,\n    backgroundColor: '#FFC107',\n    theme: 'dark',\n    progressBarColor: '#FFA000',\n    iconColor: '#FFFFFF',\n    titleColor: '#FFFFFF',\n    messageColor: '#FFFFFF',\n    close: false,\n    closeOnEscape: true,\n    closeOnClick: false,\n  });\n}\n"],"names":["API_KEY","BASE_URL","getImagesByQuery","query","page","params","axios","error","_a","_b","createGallery","images","gallery","markup","image","SimpleLightbox","clearGallery","showLoader","loader","hideLoader","form","mainElement","currentPage","currentQuery","isLoading","totalHits","e","searchQuery","showWarningToast","data","showErrorToast","scrollTop","scrollHeight","clientHeight","loadMoreImages","newMarkup","galleryItems","message","iziToast"],"mappings":"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"}